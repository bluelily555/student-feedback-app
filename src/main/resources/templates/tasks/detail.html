<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/header.html :: head}">
</head>
<body>
    <div th:insert="~{fragments/navbar :: navbar}"></div>
    <main class="d-flex flex-nowrap" style="max-height: none; height: auto">
        <div th:replace="~{fragments/sidebar :: sidebar}" sec:authorize="hasAnyRole('ADMIN', 'MANAGER')"></div>
        <div class="row" style="margin-top: 15px;">
        <br/><br/>
          <div  class="container table-responsive">
          <form th:method="post" th:action="@{'/tasks/' + ${taskDetail.id} + '/edit'}" th:object="${taskUpdateRequest}">
            <input type="hidden" name="_method" value="put"/>
            <div class="mb-3 row" sec:authorize="hasAnyRole('STUDENT', 'TEACHER')">
                <label for="title" class="col-sm-2 col-form-label" style="width:200px;height:40px;font-weight:bold;">태스크 명</label>
                <div class="col-sm-10">
                  <label class="form-control" type="text" th:text="${taskDetail.title}" />
                </div>
            </div>
            <div class="mb-3 row" sec:authorize="hasAnyRole('ADMIN', 'MANAGER')">
              <label for="title" class="col-sm-2 col-form-label" style="width:200px;height:40px;font-weight:bold;">태스크 명</label>
              <div class="col-sm-10">
                <input class ="form-control" id="title" type="text" name="title" th:value="${taskDetail.title}" />
                <p id="titleEmpty" style="color:red" hidden>타이틀이 비어있습니다.</p>
              </div>
            </div>
            <div class="row">
              <div class="col-md-2">
                <label for="courseName" class="col-form-label"  style="width:200px;height:40px;font-weight:bold;">기수</label>
              </div>
              <div class="col" sec:authorize="hasAnyRole('STUDENT', 'TEACHER')">
                  <label class="form-control" th:text="${taskDetail.courseInfo.name}"/>
              </div>
              <div class="col" sec:authorize="hasAnyRole('ADMIN', 'MANAGER')">
                <select id="courseName" onchange="sendCourse()" name="courseName" class ="form-select" th:field="*{courseName}" style="width:200px;height:40px;">
                  <option th:each="course:${courseList}" th:value="${course.name}" th:text="${course.name}" />
                </select>
              </div>
            </div>
            </br>
            <div class="row">
              <div class="col-md-2">
                <label for="taskStatus" class="col-form-label" style="font-weight:bold;">상태</label>
              </div>
              <div class="col-sm-10" sec:authorize="hasAnyRole('STUDENT', 'TEACHER')">
                <label class="form-control" type="text" th:text="${taskDetail.taskStatus}"></label>
              </div>
              <div class="col-md-6" sec:authorize="hasAnyRole('ADMIN', 'MANAGER')">
                <select id="taskStatus" name="taskStatus" class ="form-select" th:field="*{taskStatus}" th:value="${taskDetail.taskStatus}" style="width:200px;height:40px;">
                  <option value="CREATED">등록</option>
                  <option value="IN_PROGRESS">진행중</option>
                  <option value="ERROR">에러</option>
                  <option value="DONE">완료</option>
                </select>
              </div>
              <div class="mb-3 row">
                <label for="week" class="col-form-label" style="font-weight:bold;">주차</label>
                <div class="col-sm-10">
                  <label class ="form-control" type="text" th:text="${taskDetail.week}" sec:authorize="hasAnyRole('STUDENT', 'TEACHER')"/>
                  <input class ="form-control" type="number" id="week" name="week"  th:value="${taskDetail.week}" sec:authorize="hasAnyRole('ADMIN', 'MANAGER')">
                </div>
                <div>
                  <div class="mb-3 row">
                    <label for="day" class="col-form-label" style="font-weight:bold;">일차</label>
                    <div class="col-sm-10">
                      <label class ="form-control" type="text" th:text="${taskDetail.day}" sec:authorize="hasAnyRole('STUDENT', 'TEACHER')"/>
                      <input class ="form-control" type="number" id="day" name="day"  th:value="${taskDetail.day}" sec:authorize="hasAnyRole('ADMIN', 'MANAGER')">
                    </div>
                  </div>
                </div>
                <div>
                  <label style="font-weight:bold;">설명 : </label>
                  <textarea class="form-control" name="description" rows="10" th:value="${taskDetail.description}" sec:authorize="hasAnyRole('STUDENT', 'TEACHER')" readonly></textarea>
                  <textarea class="form-control" name="description" id="description" rows="10" th:value="${taskDetail.description}" sec:authorize="hasAnyRole('ADMIN', 'MANAGER')" placeholder="설명이 없습니다."></textarea>
                </div>
                <br/> <br/>
                <div align="right" sec:authorize="hasAnyRole('ADMIN', 'MANAGER')" >
                  <input id="chBtn" type="submit" class="btn btn-light" value="수정" style="width:200px" align="center">
                </div>
              </div>
            </div>
          </form>
            <div class="container table-responsive">
              <label style="font-weight:bold;">질문 목록  </label>
              <br/>
              <table class="table">
                <thead class="thead-dark">
                <tr>
                  <th scope="col">번호</th>
                  <th scope="col">글제목</th>
                  <th scope="col">작성자</th>
                  <th scope="col">작성일</th>
                  <th scope="col"></th>
                </tr>
                </thead>
                <tbody>
                <!-- CONTENTS   !-->
                <tr th:each="board : ${boardList}">
                  <th scope="row" th:text="${board.id}"></th>
                  <td th:text="${board.title}"></td>
                  <td th:text="${board.writer}"></td>
                  <td th:text="${#temporals.format(board.createdDate, 'yyyy-MM-dd HH:mm')}">
                  </td>
                  <td>
                    <a th:href="@{'/boards/code/detail/' + ${board.id}}" style="display: inline-block;">
                      <button class="btn btn-light">상세보기</button>
                    </a>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
    </main>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    <script type="text/javascript" src="/js/custom_func.js"></script>
    <script>
      $(document).ready(function() {
        $('#title').on("propertychange change keyup paste input ", function() {
          let title = $("#title").val();
          if(title.length === 0){
            show("titleEmpty")
            check_activate(false, "chBtn")
          }else{
            hide("titleEmpty")
            check_activate(true, "chBtn")
          }
        })
      })
      function sendCourse(){
        let courseName = $('#courseName').val();

        $.ajax({
          type: 'POST',
          url: '/tasks/sendCourse',
          data:{
            courseName: courseName
          }
          ,success:function(res){
            let week = res["week"]
            let day = res["day"]
            $('#week').val(week);
            $('#day').val(day);
          }
        });
      }

    </script>

</body>
<footer th:replace="~{fragments/footer.html :: footer}"/>
</html>
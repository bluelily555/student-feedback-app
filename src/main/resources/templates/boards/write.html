<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head th:replace="~{fragments/header.html :: head}">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <title>코드 글쓰기</title>
    <style>
        body{margin-top:20px; background-color: #eeeeee;}
        .editor_toolbar {
            border: 1px solid lightgray;
            background-color: #f8f8f8;
            padding: 5px;
            display: flex;
            align-items: center;
        }

    </style>

</head>
<body>
<div th:insert="~{fragments/navbar :: navbar}" id="codeForm"></div>

<div>
    <p>Task: </p>
    <h1 th:text="${taskTitle}"></h1>
</div>

<div class="container bootstrap snippets bootdey">
    <div class="row">
        <div class="col-md-offset-3 col-md-6 col-xs-12">
            <div class="well well-sm well-social-post">
                <form id="writeForm" autocomplete="off" th:method="post" th:action="|@{/boards/tasks/{taskId} (taskId=${taskId})}|" th:object="${boardCreateRequest}">
                    <div>
                        <!--        th:value="${userName}"-->
                        <input id="userName" type="hidden" name="userName" th:value="${userName}" />
                        <input type="hidden" name="taskId" id="taskId" th:value="${taskId}" />
                        <input class="mt-4" type="text" maxlength='30' th:field="*{title}" id="title" placeholder="제목을 입력하세요"/>
                        <br/>
                        <input type="hidden" id="writer" name="writer" maxlength='10' th:value="${userName}"/>
                        <br/>
                        <div id="content_div">
                            <textarea name="codeContent" id="codeContent" th:field="*{codeContent}" hidden></textarea>
                            <textarea class="form-control" style="height:250px; width:50vw;" maxlength='1000' id="content" th:field="*{content}" name="content"></textarea>
                            <div class="editor_toolbar"></div>
                            <div id="editor" style="width:50vw; height: 250px; overflow-y: scroll;"></div>
                        </div>
                        <br/>
                        <input type="submit" id="submitBtn"  class="btn btn-outline-primary mr-2" value="작성">
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!--  <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.4.12/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>-->
<!--  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.15.0/ace.js" integrity="sha512-vgArOyW+sdp69qm3025hO1uoxhMZ7rzc2NZbaC/0eUD92rYIx4YSI/NdQ1+oINXb8tXoFQJyQqpfV9KxoPGuCw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>-->
<script src="http://ajaxorg.github.io/ace-builds/src/ace.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>

<script>
    /*
    1. 코드 편집하는 ace Editor의 Font를 20으로 설정 해주세요.
    2. 현재 글쓰는 부분 왼쪽, 코드 올리는 부분 오른쪽으로 되어 있는데 위 아래로 해서 스크롤 되게 해주세요.
    3. 작성자가 표시되고 있습니다. 작성자는 빼주세요.
    4. 텍스트박스 세로 길이를 현재의 절반으로 줄이고 길어지면 스크롤되게 해주세요.
     */
    let editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.session.setMode("ace/mode/javascript");
    let postContent = $("#codeContent").val()
    document.getElementById('editor').style.fontSize='20px';
    ace.config.loadModule('ace/ext/language_tools', function() {
        editor.setOptions({
            enableBasicAutocompletion: true,
            enableSnippets: true,
            enableLiveAutocompletion: true
        })
    });
    function changeLanguage(language){
        editor.getSession().setMode("ace/mode/" + language);
    }
    // editor.$blockScrolling = Infinity;
    let customToolbar = [
        {
            name:"language",
            buttonClass: "fa fa-code",
            tooltip: "Choose Language",
            select: function(){
                let sel = document.createElement("select")
                let languages = ["javascript", "python", "html","css", "java", "c++","c"];
                for(let i = 0; i <languages.length; i++){
                    let opt = document.createElement("option");
                    opt.value = languages[i];
                    opt.text = languages[i];
                    sel.appendChild(opt);
                }
                sel.addEventListener("change", function(){
                    let language = this.value;
                    changeLanguage(language);
                });
                return sel;
            }
        }
    ];
    editor.setOptions({
        toolbar: customToolbar
    })


    // editor value를 codeContent로 넣어주는 과정
    $("#editor").on("propertychange change keyup paste input ", function() {
        postContent = editor.getValue();
        console.log(postContent)
    })
    document.getElementById("writeForm").onsubmit = function(evt){
        document.getElementById("codeContent").value = editor.getValue();
    }

</script>


</body>
</html>
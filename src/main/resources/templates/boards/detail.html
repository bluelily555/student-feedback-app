<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
<head th:replace="~{fragments/header.html :: head}">
    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
    <meta charset="UTF-8">
    <title>code Detail</title>
</head>
<body>
<section>
    <div th:insert="~{fragments/navbar :: navbar}"></div>
    <div class="text-dark">
        <div class="row d-flex justify-content-center">
            <div class="col-md-10 col-lg-8 col-xl-6">
                <div class="card">
                    <div class="card-body p-4">
                        <div class="d-flex flex-start w-100">
                            <div class="w-100">
                                <div class="form-outline">
                                    <!--                                        <input type="hidden" name="_method" value="put"/>-->
                                    <!--                                        <input type="hidden" name="id" th:value="${boardList.id}"/>-->
                                    <!--                                        <input type="text" name="title" th:value="${boardList.title}"/> <br>-->
                                    <!--                                        <input type="text" name="writer" th:value="${boardList.writer}"/> <br>-->
                                    <h5 style="float: left; margin-right: 5px">제목 :</h5>
                                    <h5 th:text="${boardInfo.title}"></h5>
                                    <h5 style="float: left; margin-right: 5px">작성자 :</h5>
                                    <p th:text="${boardInfo.userName}"></p>
                                    <h5 style="float: left; margin-right: 5px">작성 시간 :</h5>
                                    <p th:text="${#temporals.format(boardInfo.createdDate, 'yyyy-MM-dd HH:mm')}"></p>
                                    <div style="display: block">
                                        <h5>작성 내용</h5>
                                        <input type="hidden" id="language" th:value="${boardInfo.language}"></input>
                                        <pre class="prettyprint" th:text="${boardInfo.content}"></pre>
                                        <div id="codeContent" style="width:45vw; height: 50vh; display: inline-block;" th:text="${boardInfo.codeContent}" th:value="${boardInfo.codeContent}"></div>

                                    </div>
<!--                                    <div style="display: block">-->
<!--                                        <a th:href="@{'/boards/edit/' + ${boardList.id}}">-->
<!--                                            <button class="btn btn-danger" style="float:right;margin-right: 5px;">수정</button>-->
<!--                                        </a>-->
<!--                                    </div>-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer d-flex">
                        <th:block th:if="${isLiked==true}">
                            <form class="ms-auto" th:action="@{'/boards/' + ${boardInfo.id} + '/unlike'}" method="post">
                                <button type="submit" class="btn btn-danger">[[${boardInfo.likes}]] <i class="fa-regular fa-heart"></i></button>
                            </form>
                        </th:block>
                        <th:block th:unless="${isLiked==true}">
                            <form class="ms-auto" th:action="@{'/boards/' + ${boardInfo.id} + '/like'}" method="post">
                                <button type="submit" class="btn btn-outline-danger" th:disabled="${#authorization.expression('hasRole(''ROLE_ANONYMOUS'')')}">[[${boardInfo.likes}]] <i class="fa-regular fa-heart"></i></button>
                            </form>
                        </th:block>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section>
    <div class="my-5 py-5 text-dark">
        <div class="row d-flex justify-content-center">
            <div class="col-md-10 col-lg-8 col-xl-6">
                <div class="card">
                    <div class="card-body p-4">
                        <div class="d-flex flex-start w-100">
                            <div class="w-100">
                                <h5>Add a comment</h5>
                                <form class="form-group" th:object="${commentCreateRequest}"  th:method="post" th:action="|@{/boards/{boardId}/comment (boardId=${boardInfo.id})}|">
                                    <div style="text-align: right">
                                        <div>
                                            <textarea rows="3" th:field="*{comment}" style="width: 100%"></textarea>
                                            <button class="btn btn-light" type="submit">댓글 추가</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!--댓글 목록-->
<div class="offset-3 col-6">
<div th:each="comment : ${commentList}" th:align="center">
       <div class="card-body" style="text-align: left;">
            <h5 class="card-title" th:text="'작성자 : ' + ${comment.userName}"></h5>
            <h6 class="card-subtitle mb-2 text-muted" th:text="'작성일 : ' + ${#temporals.format(comment.createdAt, 'yy/MM/dd HH:mm')}"></h6>
           <textarea rows="3" class="card-text" th:text="${comment.comment}" id="comment" name="comment"
                     style="width: 100%"></textarea>
            <div class="d-flex">
                <th:block th:if="${comment.likeStatus==true}">
                    <form class="ms-auto" th:action="@{'/comments/' + ${comment.id} + '/unlike'}" method="post">
                        <button type="submit" class="btn btn-danger">[[${comment.likes}]] <i class="fa-regular fa-heart"></i></button>
                    </form>
                </th:block>
                <th:block th:unless="${comment.likeStatus==true}">
                    <form class="ms-auto" th:action="@{'/comments/' + ${comment.id} + '/like'}" method="post">
                        <button type="submit" class="btn btn-outline-danger" th:disabled="${#authorization.expression('hasRole(''ROLE_ANONYMOUS'')')}">[[${comment.likes}]] <i class="fa-regular fa-heart"></i></button>
                    </form>
                </th:block>
            </div>
        </div>

    <br/>
</div>
</div>


<script src="https://cdn.jsdelivr.net/npm/ace-builds@1.4.12/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
<script>
    $(document).ready(function(){
        let editor = ace.edit("codeContent");
        let lang = document.getElementById("language").value
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/"+lang);
        editor.setShowPrintMargin(false);
        editor.setReadOnly(true);
        var mode = editor.session.getMode().$id;
        console.log(lang)
        console.log(mode);
    })

</script>
</body>
</html>